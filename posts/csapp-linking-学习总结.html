<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>CSAPP Linking 学习总结</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@" /><meta name="twitter:title" content="CSAPP Linking 学习总结" /><meta name="twitter:description" content="The content is recoverd from Wordpress Blog, for more details please check HERE"><meta name="description" content="The content is recoverd from Wordpress Blog, for more details please check HERE"><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet"><link href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.0/styles/github.min.css" rel="stylesheet"><link rel="canonical" href="/posts/csapp-linking-%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93"><link rel="alternate" type="application/atom+xml" title="VOID001's WOWO" href="/feed.xml" /> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga( 'create', 'UA-73703130-2', 'auto' ); ga( 'send', 'pageview' ); </script></head><body><aside class="logo"> <a href="/"> <img src="/assets/avatar.jpeg" class="gravatar"> </a> <span class="logo-prompt">Back to Home</span></aside><div class="footer-flex" style="margin-bottom: 4px"> Thinking, Coding, Improving</div><div class="footer-flex" style="color: #333333"> <a href="http://github.com/VOID001"><i class="fa-brands fa-lg fa-github"></i></a> <span style="margin: 4px"></span> <a href="https://t.me/s/void001_fav"><i class="fa-brands fa-lg fa-telegram"></i></a> <span style="margin: 4px"></span> <a href="/feed"><i class="fa-solid fa-lg fa-rss"></i></a></div><script src="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.1.1/js/fontawesome.min.js"></script><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>CSAPP Linking 学习总结</h1><time>August 22, 2015</time> <span>[ ]</span></div><div class="divider"></div><p>The content is recoverd from Wordpress Blog, for more details please check <a href="recover-my-blog">HERE</a></p><h5 id="august-22-2015"><a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/uncategorized/csapp-linking-%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93.html" title="10:39 pm">August 22, 2015</a></h5><p><a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/author/void001" title="View all posts by VOID001">VOID001</a> Comments <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/uncategorized/csapp-linking-%e5%ad%a6%e4%b9%a0%e6%80%bb%e7%bb%93.html#respond">0 Comment</a></p><p>1.一个C语言程序是如何被编译成为可执行程序的</p><ul><li>首先 通过C preprocessor 将C语言代码中包括的头文件都写入代码 生产 main.i文件</li><li>然后main.i的代码经过编译器 编译为汇编代码 main.s</li><li>然后main.s 的代码再经过汇编语言编译器 翻译为机器码的obj(Relocatable Object Files)文件main.o</li><li>这时候编译器的任务已经完成了 ,下一步是由链接器,将main.o,以及main.o依赖的所有obj文件 链接成为一个可执行文件, 生成了 a.out文件(静态链接)</li></ul><p>2.什么是静态链接(由于很多词语涉及专业术语,专业术语用英语描述)</p><ul><li>链接的过程分为两个子过程: Symbol Resoultion 和 Relocation. 下面概括一下两个过程:</li></ul><p>2.1 Symbol Resolution  将每个定义好的(Relocatable Object File 中的)符号分配唯一的一个名称 , 举个例子说明一下, 如果有两个C语言文件 需要被链接成一个可执行的文件, 并且在a.c里有一个全局变量 声明 int counter, 在另一个文件b.c里也有同样的一个声明, 这时将两个a.o b.o文件链接为一个可执行文件的时候,就会给两个文件的counter分配不同的名字, 保证每个符号都有唯一的一个名字与之对应</p><p>2.2 Relocation 将每个Relocatable Object File 链接到的地址(如函数调用时的地址) 修正为正确的值. 同样举例来说明,在编译如下程序的时候</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include"vecAdd.h"

int main(void)
{
    vec a;
    vec b;
    a.x = 2; b.x = 3; a.y = 1; b.y = -1;
    vec c = Add\_vec(a,b);
    return 0;
}
</code></pre></div></div><p>由于编译器只是将每个C文件编译为相应的Relocatable Object File, 因而找不到在另一个文件,比如 vecAdd.c 里定义的函数 Add_vec的详细实现, 这时候 编译器会给这个函数一个假的入口地址 ,留在以后交给连接器处理, 如果连接器在其他的Relocatable Object File里找到了 Add_vec的定义的话 ,就会在Relocation这一步将这个函数的地址修改为正确的入口地址, 如果没有找到的话,就会报link error. 这就是Relocation的简单介绍.</p><p>3.Object Files 的种类:</p><p>ObjectFile 有三种 1. Relocatable Object File 2. Executable object file 3. Shared Object File , 其中第三个是与动态链接有关的一种Object File . 第二个就是我们俗知的可执行文件 , 另外根据文件格式不同 可以将ObjectFile分为 COFF, PE ,ELF, ELF是linux 上常见的Object File 格式.</p><p>4.Relocatable Object Files 详细说明</p><p>不论是文件 还是Object 还是程序 在计算机里存储都是以01形式存储的,都可以看作是文件 ,只不过由于规划的格式不同,解析的方式不同 ,才使得他们有的成为了文件有的成为了程序, Relocatable Object File 就可以看成有着特殊结构文件, 这个文件提供给了链接器在将Objects链接为可执行程序的需要的全部信息.</p><p>下面画出一个图来表示一下 Relocatable Object Files 的结构</p><p>2016.5.9 下文更新, 关于ELF文件结构可以参考这个文章</p><p><a href="https://web.archive.org/web/20201022003148/http://120.27.97.96/?p=801">ELF 文件格式初步探索</a></p><hr /><p><a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/category/uncategorized">Uncategorized</a> <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/c-linux">C. Linux</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/kernel">kernel</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/laravel">Laravel</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/php">PHP</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/python">Python</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/shell">Shell</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/web">Web</a>, <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/tag/wine">wine</a></p><hr /><h2 id="historical-comments">Historical Comments</h2><p>Post navigation ————— <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/linux/gdb-%e4%b8%8b%e8%b0%83%e8%af%95%e5%a4%9a%e7%ba%bf%e7%a8%8b.html">NEXT<br /> gdb 下调试多线程</a> <a href="https://web.archive.org/web/20201022003148/https://void-shana.moe/linux/wine-%e8%b0%83%e8%af%95bug%e6%80%bb%e7%bb%93msys2%e7%af%87.html">PREVIOUS Wine 调试bug总结(MSYS2篇)</a></p><script src="https://giscus.app/client.js" data-repo="VOID001/VOID001.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkzMzI0MDI4NQ==" data-category="Announcements" data-category-id="DIC_kwDOAfs03c4COSSU" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="light" data-lang="en" data-loading="lazy" crossorigin="anonymous" async> </script></article><div class="back"> <a href="/">Back</a></div><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script> <script>hljs.highlightAll();</script></main></body></html>